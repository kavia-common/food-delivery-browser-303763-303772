{"is_source_file": true, "format": "Kotlin", "description": "This Kotlin file implements a singleton object RatingsRepository that manages local ratings and reviews data for a food delivery application. It handles hydration from local storage, in-memory caching, live data observation, and persistence for reviews and their aggregates, providing methods for CRUD operations on reviews.", "external_files": ["org.example.app.data.storage.PreferencesStorage", "org.example.app.data.ratings.RatingsCodec"], "external_methods": ["PreferencesStorage.from", "RatingsCodec.decodeReviews", "RatingsCodec.decodeAggregates", "RatingsCodec.encodeReviews", "RatingsCodec.encodeAggregates"], "published": ["RatingsRepository.initialize", "RatingsRepository.getReviews", "RatingsRepository.getAggregate", "RatingsRepository.getAggregateNow", "RatingsRepository.addReview", "RatingsRepository.updateReview", "RatingsRepository.deleteReview"], "classes": [], "methods": [{"name": "initialize", "description": "Hydrates the repository from local preferences storage, decoding stored reviews and aggregates, and sets up in-memory structures."}, {"name": "getReviews", "description": "Returns LiveData stream of latest reviews for a given target."}, {"name": "getAggregate", "description": "Returns LiveData stream of the aggregate rating for a given target."}, {"name": "getAggregateNow", "description": "Provides immediate access to the current aggregate rating value for a target."}, {"name": "addReview", "description": "Creates a new review for a target, updates in-memory state, recomputes aggregates, persists data, and updates LiveData."}, {"name": "updateReview", "description": "Updates an existing review's details, recomputes the aggregate, persists, and updates LiveData."}, {"name": "deleteReview", "description": "Deletes a review by id, updates state, recomputes aggregate, persists, and updates LiveData."}, {"name": "currentReviewsForTarget", "description": "Retrieves the current list of reviews for a specified target, ordered newest first."}, {"name": "recomputeAllAggregates", "description": "Recomputes aggregates for all targets based on current reviews."}, {"name": "recomputeAggregateForTarget", "description": "Recalculates the aggregate rating for a specific target."}, {"name": "persist", "description": "Encodes and saves current reviews and aggregates into preferences storage."}, {"name": "publishAllTargets", "description": "Publishes current reviews and aggregates for all targets to LiveData."}, {"name": "publishTarget", "description": "Updates LiveData with current reviews and aggregate for a specific target."}], "calls": ["PreferencesStorage.from", "RatingsCodec.decodeReviews", "RatingsCodec.decodeAggregates", "RatingsCodec.encodeReviews", "RatingsCodec.encodeAggregates", "storage?.loadRatingsReviewsEncoded", "storage?.loadRatingsAggregatesEncoded", "storage?.saveRatingsReviewsEncoded", "storage?.saveRatingsAggregatesEncoded", "System.currentTimeMillis"], "search-terms": ["RatingsRepository", "ReviewsEncoding", "AggregateRecalculation", "LiveDataReviews", "local-Hydration", "in-memory indexes", "ReviewTarget", "RatingsCodec", "ReviewsStorage"], "state": 2, "file_id": 76, "knowledge_revision": 252, "git_revision": "", "hash": "409ceae3bb339bdf23a36f58f3566770", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/ratings/RatingsRepository.kt", "revision_history": [{"252": ""}]}