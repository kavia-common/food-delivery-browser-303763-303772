{"is_source_file": true, "format": "Kotlin", "description": "This file defines the PreferencesStorage class which manages lightweight local state persistence using Android's SharedPreferences. It handles saving and loading user preferences, cart information, favorite IDs, ratings, and other app-specific settings, with a focus on simplicity and resilience to malformed data.", "external_files": ["android.content.Context", "android.content.SharedPreferences", "org.example.app.data.storage.models.StoredCartLine", "org.example.app.data.cart.AppliedPromo", "org.example.app.data.cart.FeeSettings", "SafeCodec"], "external_methods": ["SharedPreferences.getString", "SharedPreferences.edit", "SharedPreferences.remove", "SharedPreferences.putString", "SafeCodec.decodeStringSet", "SafeCodec.encodeStringSet", "SafeCodec.decodeCartLines", "SafeCodec.encodeCartLines", "SafeCodec.decodeAppliedPromo", "SafeCodec.encodeAppliedPromo", "SafeCodec.decodeFeeSettings", "SafeCodec.encodeFeeSettings", "SafeCodec.decodeStringList", "SafeCodec.encodeStringList"], "published": ["PreferencesStorage"], "classes": [{"name": "PreferencesStorage", "description": "A singleton class providing methods to persist and retrieve lightweight app data values such as user favorites, cart contents, preferences, and app state information using SharedPreferences."}], "methods": [{"name": "from", "description": "Factory method to instantiate PreferencesStorage with application context."}, {"name": "loadFavoriteRestaurantIds", "description": "Loads favorited restaurant IDs; returns empty set if missing or malformed."}, {"name": "saveFavoriteRestaurantIds", "description": "Saves favorited restaurant IDs."}, {"name": "loadFavoriteMenuItemIds", "description": "Loads favorited menu item IDs; returns empty set if missing or malformed."}, {"name": "saveFavoriteMenuItemIds", "description": "Saves favorited menu item IDs."}, {"name": "loadCartLines", "description": "Loads cart lines; returns an empty list if data is missing or malformed."}, {"name": "saveCartLines", "description": "Persists cart lines."}, {"name": "loadCartPromo", "description": "Loads persisted cart promo settings; returns null if missing or malformed."}, {"name": "saveCartPromo", "description": "Persists cart promo settings, or removes if null."}, {"name": "loadCartFeeSettings", "description": "Loads cart fee settings; returns null if missing or malformed."}, {"name": "saveCartFeeSettings", "description": "Saves cart fee settings, or removes if null."}, {"name": "loadPreferenceString", "description": "Loads arbitrary preference string for a given key, with a prefixed key."}, {"name": "savePreferenceString", "description": "Saves arbitrary preference string for a given key, with a prefixed key."}, {"name": "loadCartOrderInstructions", "description": "Loads per-order instructions; returns null if not set."}, {"name": "saveCartOrderInstructions", "description": "Saves per-order instructions; removes if blank or null."}, {"name": "loadActiveDeliveryOrderEncoded", "description": "Loads opaque encoded delivery order state."}, {"name": "saveActiveDeliveryOrderEncoded", "description": "Persists encoded delivery order state."}, {"name": "loadRatingsReviewsEncoded", "description": "Loads ratings/reviews blob."}, {"name": "saveRatingsReviewsEncoded", "description": "Persists ratings/reviews blob."}, {"name": "loadRatingsAggregatesEncoded", "description": "Loads ratings aggregates blob."}, {"name": "saveRatingsAggregatesEncoded", "description": "Persists ratings aggregates blob."}, {"name": "loadRecentlyViewedRestaurantIds", "description": "Loads list of recently viewed restaurant IDs."}, {"name": "saveRecentlyViewedRestaurantIds", "description": "Saves list of recently viewed restaurant IDs."}, {"name": "loadRecentlyViewedMenuItemIds", "description": "Loads list of recently viewed menu item IDs."}, {"name": "saveRecentlyViewedMenuItemIds", "description": "Saves list of recently viewed menu item IDs."}], "calls": ["prefs.getString", "prefs.edit", "prefs.edit().apply", "SafeCodec.decodeStringSet", "SafeCodec.encodeStringSet", "SafeCodec.decodeCartLines", "SafeCodec.encodeCartLines", "SafeCodec.decodeAppliedPromo", "SafeCodec.encodeAppliedPromo", "SafeCodec.decodeFeeSettings", "SafeCodec.encodeFeeSettings", "SafeCodec.decodeStringList", "SafeCodec.encodeStringList", "prefs.remove", "preferencesPrefs.putString"], "search-terms": ["PreferencesStorage", "SharedPreferences", "local storage", "app preferences", "cart lines", "favorite restaurant IDs", "favorite menu items", "cart promo", "cart fee settings", "recently viewed", "ratings reviews", "order instructions"], "state": 2, "file_id": 35, "knowledge_revision": 314, "git_revision": "eb56da73e6955c1accc8178cc80fc5b8cf098395", "revision_history": [{"81": "ac812a530cde5aab51ee830d20669449da61e0a3"}, {"115": "ac812a530cde5aab51ee830d20669449da61e0a3"}, {"165": "50c7aa46afe96fafa36f6da7e89f8349bbf6dc59"}, {"201": "6e91d21a038bee6a12947e6117ed8dfb31963ce7"}, {"250": "5e15db62566d0828eda2f083edf5df8b791c1e55"}, {"314": "eb56da73e6955c1accc8178cc80fc5b8cf098395"}], "hash": "c9e6206cb4d59b6d72ef5cd9f2390d0b", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/storage/PreferencesStorage.kt"}