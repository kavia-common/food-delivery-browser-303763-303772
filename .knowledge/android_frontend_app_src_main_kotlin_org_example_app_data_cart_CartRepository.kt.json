{"is_source_file": true, "format": "Kotlin", "description": "This file defines a singleton repository for managing shopping cart state within an Android food delivery app. It handles in-memory cart operations, persistence through shared preferences, promo code application, and calculation of totals including taxes and fees. The class interacts with models such as MenuItem, CartLine, and ItemConfiguration, and provides methods for adding, removing, updating items, and computing related costs.", "external_files": ["org/example/app/data/models/CartLine", "org/example/app/data/models/ItemConfiguration", "org/example/app/data/models/MenuItem", "org/example/app/data/models/computeOptionsDeltaCents", "org/example/app/data/storage/PreferencesStorage", "org/example/app/data/storage/models/StoredCartLine"], "external_methods": ["PreferencesStorage.from", "PreferencesStorage.loadCartLines", "PreferencesStorage.loadCartPromo", "PreferencesStorage.loadCartFeeSettings", "PreferencesStorage.saveCartLines", "PreferencesStorage.saveCartPromo", "PreferencesStorage.saveCartFeeSettings", "parseVariantSelectionMap", "parseAddOnSelectionSet", "encodeVariantSelectionMap", "encodeAddOnSelectionSet"], "published": ["CartRepository", "CartTotals", "PromoApplyResult", "FeeSettings", "AppliedPromo", "PromoKind"], "classes": [{"name": "CartTotals", "description": "Data class representing the breakdown of cart costs including subtotal, discounts, fees, tax, and total."}, {"name": "FeeSettings", "description": "Data class encapsulating fee-related settings like delivery fee, service fee, and tax rate."}, {"name": "AppliedPromo", "description": "Data class representing an applied promotional code with its type and value."}, {"name": "PromoKind", "description": "Enum defining types of promotional discounts: percent off and fixed cents off."}], "methods": [{"name": "initialize", "description": "Loads cart data and settings from persistent storage. Reconstructs cart lines and applies previous promo and fee settings."}, {"name": "add", "description": "Adds one quantity of a menu item with default configuration to the cart."}, {"name": "addConfigured", "description": "Adds one quantity of a menu item with a specified configuration."}, {"name": "remove", "description": "Removes a cart line entirely given the CartLine object."}, {"name": "remove", "description": "Removes all cart lines associated with a given menu item."}, {"name": "updateQuantity", "description": "Sets the quantity for a cart line, removing it if quantity drops to zero."}, {"name": "updateQuantity", "description": "Updates the quantity for a menu item using default configuration."}, {"name": "getQuantity", "description": "Returns total quantity for an item ID across all configurations."}, {"name": "getLineQuantity", "description": "Returns quantity for a specific item ID and configuration."}, {"name": "getDefaultLine", "description": "Retrieves the cart line with the default configuration for an item, if exists."}, {"name": "applyPromoCode", "description": "Validates and applies a promo code, updating the cart state."}, {"name": "removePromo", "description": "Removes any active promo code from the cart."}, {"name": "setFeeSettings", "description": "Updates and persists fee settings."}, {"name": "computeSubtotalCents", "description": "Calculates the subtotal price based on cart lines and options."}, {"name": "computeDiscountCents", "description": "Calculates total discount amount based on applied promo."}, {"name": "computeDeliveryFeeCents", "description": "Returns delivery fee; zero if cart is empty."}, {"name": "computeServiceFeeCents", "description": "Returns service fee; zero if cart is empty."}, {"name": "computeTaxCents", "description": "Calculates tax based on subtotal minus discount and applies current tax rate."}, {"name": "computeTotalCents", "description": "Computes the total cost including subtotal, discount, fees, and tax."}, {"name": "publish", "description": "Updates LiveData objects and optionally persists the current cart state."}, {"name": "computeTotalsInternal", "description": "Private method to assemble all totals based on current cart lines."}, {"name": "persistCart", "description": "Saves current cart lines to persistent storage."}, {"name": "defaultFeeSettings", "description": "Provides default fee settings."}, {"name": "validatePromoMock", "description": "Mocks promo code validation with predefined codes and discounts."}, {"name": "buildLineKey", "description": "Creates a unique key for cart lines based on item ID and configuration."}, {"name": "encodeVariantSelectionMap", "description": "Serializes variant selection map into a string for storage."}, {"name": "parseVariantSelectionMap", "description": "Deserializes a string back into a variant selection map."}, {"name": "encodeAddOnSelectionSet", "description": "Serializes a set of add-on option IDs into a comma-separated string."}, {"name": "parseAddOnSelectionSet", "description": "Deserializes a string into a set of add-on option IDs."}, {"name": "defaultConfigurationFor", "description": "Generates a default item configuration selecting the first variant options for required groups."}], "calls": ["PreferencesStorage.from", "PreferencesStorage.loadCartLines", "PreferencesStorage.loadCartPromo", "PreferencesStorage.loadCartFeeSettings", "PreferencesStorage.saveCartLines", "PreferencesStorage.saveCartPromo", "PreferencesStorage.saveCartFeeSettings", "parseVariantSelectionMap", "parseAddOnSelectionSet", "encodeVariantSelectionMap", "encodeAddOnSelectionSet", "computeOptionsDeltaCents"], "search-terms": ["CartRepository", "liveData", "cart lines", "promo code", "calculate totals", "Android local storage", "PreferencesStorage", "cart item configuration", "promo validation", "cart fee settings"], "state": 2, "file_id": 14, "knowledge_revision": 147, "git_revision": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb", "revision_history": [{"49": ""}, {"78": "bee0400471853af593870aafc261dd9c589a0db7"}, {"118": "50c7aa46afe96fafa36f6da7e89f8349bbf6dc59"}, {"147": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb"}], "hash": "4f1306b59045d7e8a78c2544960d1d6c", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/cart/CartRepository.kt"}