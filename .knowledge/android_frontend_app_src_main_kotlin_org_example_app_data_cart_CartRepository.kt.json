{"is_source_file": true, "format": "Kotlin", "description": "This file defines a singleton object CartRepository that manages shopping cart state in an Android app. It handles in-memory cart data, persists state via PreferencesStorage, manages promo codes, calculates totals, and exposes LiveData for UI observation.", "external_files": ["org/example/app/data/models/CartLine.kt", "org/example/app/data/models/MenuItem.kt", "org/example/app/data/storage/PreferencesStorage.kt", "org/example/app/data/storage/models/StoredCartLine.kt"], "external_methods": ["PreferencesStorage.from()", "PreferencesStorage.loadCartLines()", "PreferencesStorage.loadCartPromo()", "PreferencesStorage.saveCartPromo()", "PreferencesStorage.loadCartFeeSettings()", "PreferencesStorage.saveCartFeeSettings()"], "published": ["CartRepository", "PromoApplyResult", "CartTotals", "AppliedPromo", "FeeSettings", "PromoKind"], "classes": [{"name": "CartTotals", "description": "Data class holding various total amounts related to the cart, such as subtotal, discount, and total cents."}, {"name": "AppliedPromo", "description": "Represents an applied promotional code, including its code, type, and value."}, {"name": "FeeSettings", "description": "Configuration for delivery, service fees, and tax rate."}], "methods": [{"name": "initialize", "description": "Initializes the cart repository from persisted preferences, restoring cart lines and promo state."}, {"name": "add", "description": "Adds one quantity of a menu item to the cart."}, {"name": "remove", "description": "Removes a menu item from the cart."}, {"name": "updateQuantity", "description": "Sets the quantity for a menu item; removes it if quantity is zero or less."}, {"name": "getQuantity", "description": "Returns the current quantity of an item by ID."}, {"name": "applyPromoCode", "description": "Applies a promo code with mock validation, returns success or error."}, {"name": "removePromo", "description": "Removes any active promo code."}, {"name": "setFeeSettings", "description": "Updates fee settings and persists them."}, {"name": "computeSubtotalCents", "description": "Calculates sum of (price * quantity) for all cart items."}, {"name": "computeDiscountCents", "description": "Calculates total discount based on promo and subtotal."}, {"name": "computeDeliveryFeeCents", "description": "Returns delivery fee or zero if cart is empty."}, {"name": "computeServiceFeeCents", "description": "Returns service fee or zero if cart is empty."}, {"name": "computeTaxCents", "description": "Calculates tax on the discounted subtotal."}, {"name": "computeTotalCents", "description": "Calculates the final total in cents."}, {"name": "publish", "description": "Updates LiveData objects and persists cart state if needed."}, {"name": "computeTotalsInternal", "description": "Helper to compute aggregate totals for the cart."}, {"name": "persistCart", "description": "Saves current cart lines to preferences storage."}, {"name": "defaultFeeSettings", "description": "Provides default fee configuration."}, {"name": "validatePromoMock", "description": "Mock validation of promo codes for testing purposes."}], "calls": ["PreferencesStorage.from()", "PreferencesStorage.loadCartLines()", "PreferencesStorage.loadCartPromo()", "PreferencesStorage.saveCartPromo()", "PreferencesStorage.loadCartFeeSettings()", "PreferencesStorage.saveCartFeeSettings()"], "search-terms": ["CartRepository", "live data cart lines", "promo codes menu item", "calculate total cents", "apply promo code", "preferences storage"], "state": 2, "file_id": 14, "knowledge_revision": 118, "git_revision": "50c7aa46afe96fafa36f6da7e89f8349bbf6dc59", "revision_history": [{"49": ""}, {"78": "bee0400471853af593870aafc261dd9c589a0db7"}, {"118": "50c7aa46afe96fafa36f6da7e89f8349bbf6dc59"}], "hash": "ebf4224fda0682f579fdcd059095513c", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/cart/CartRepository.kt"}