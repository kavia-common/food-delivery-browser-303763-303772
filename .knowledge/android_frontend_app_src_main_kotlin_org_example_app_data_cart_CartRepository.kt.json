{"is_source_file": true, "format": "Kotlin", "description": "This file defines an in-memory singleton repository for managing a shopping cart in an Android food delivery app. It handles cart operations such as adding, removing, updating items, applying promo codes, calculating totals, and persisting state using local storage. The CartRepository manages cart state during app runtime with LiveData for UI observation and supports serialization/deserialization for persistence.", "external_files": ["org.example.app.data.models.CartLine", "org.example.app.data.models.ItemConfiguration", "org.example.app.data.models.MenuItem", "org.example.app.data.models.computeOptionsDeltaCents", "org.example.app.data.storage.PreferencesStorage", "org.example.app.data.storage.models.StoredCartLine"], "external_methods": ["PreferencesStorage.from", "PreferencesStorage.loadCartLines", "PreferencesStorage.loadCartOrderInstructions", "PreferencesStorage.loadCartPromo", "PreferencesStorage.loadCartFeeSettings", "PreferencesStorage.saveCartLines", "PreferencesStorage.saveCartPromo", "PreferencesStorage.saveCartOrderInstructions", "PreferencesStorage.saveCartFeeSettings"], "published": ["CartRepository.initialize", "CartRepository.add", "CartRepository.addConfigured", "CartRepository.remove", "CartRepository.updateQuantity", "CartRepository.getQuantity", "CartRepository.getLineQuantity", "CartRepository.getDefaultLine", "CartRepository.applyPromoCode", "CartRepository.removePromo", "CartRepository.setFeeSettings", "CartRepository.computeSubtotalCents", "CartRepository.computeDiscountCents", "CartRepository.computeDeliveryFeeCents", "CartRepository.computeServiceFeeCents", "CartRepository.computeTaxCents", "CartRepository.computeTotalCents", "CartRepository.setOrderInstructions", "CartRepository.clearOrderInstructions", "CartRepository.updateLineItemNote"], "classes": [{"name": "CartTotals", "description": "Data class holding detailed breakdown of cart costs, including item count, subtotal, discounts, fees, tax, and total amount."}, {"name": "FeeSettings", "description": "Configuration class for cart fee parameters like delivery fee, service fee, and tax rate."}, {"name": "AppliedPromo", "description": "Represents an applied promotional discount, including code, type (percent or fixed), and value."}], "methods": [{"name": "initialize", "description": "Initializes the cart repository by loading persisted cart state from local storage. Should be called once on app start."}, {"name": "add", "description": "Adds one unit of a menu item with default configuration to the cart."}, {"name": "addConfigured", "description": "Adds one unit of a menu item with a specific configuration to the cart."}, {"name": "remove", "description": "Removes a cart line or all lines for an item from the cart."}, {"name": "updateQuantity", "description": "Updates quantity for a given cart line or item; setting quantity <= 0 removes the item."}, {"name": "getQuantity", "description": "Returns total quantity of an item across all configurations."}, {"name": "getLineQuantity", "description": "Returns quantity for a specific item configuration."}, {"name": "getDefaultLine", "description": "Retrieves the default configuration cart line for a given item."}, {"name": "applyPromoCode", "description": "Validates and applies a promo code to the cart, returning a result indicating success or failure."}, {"name": "removePromo", "description": "Removes any active promo code from the cart."}, {"name": "setFeeSettings", "description": "Updates and persists the cart's fee configuration."}, {"name": "computeSubtotalCents", "description": "Calculates sum of item prices multiplied by quantities, considering option delta adjustments."}, {"name": "computeDiscountCents", "description": "Calculates the total discount amount based on applied promo code."}, {"name": "computeDeliveryFeeCents", "description": "Returns the delivery fee, which is flat and zero if cart is empty."}, {"name": "computeServiceFeeCents", "description": "Returns the service fee, which is flat and zero if cart is empty."}, {"name": "computeTaxCents", "description": "Calculates tax based on taxable amount which is subtotal minus discount."}, {"name": "computeTotalCents", "description": "Calculates total cart price summing subtotal, discounts, fees, and tax."}, {"name": "setOrderInstructions", "description": "Sets special instructions for the order, persisted across sessions."}, {"name": "clearOrderInstructions", "description": "Clears any set order instructions."}, {"name": "updateLineItemNote", "description": "Updates notes associated with a specific cart line."}], "calls": ["PreferencesStorage.from", "PreferencesStorage.loadCartLines", "PreferencesStorage.loadCartOrderInstructions", "PreferencesStorage.loadCartPromo", "PreferencesStorage.loadCartFeeSettings", "PreferencesStorage.saveCartLines", "PreferencesStorage.saveCartPromo", "PreferencesStorage.saveCartOrderInstructions", "PreferencesStorage.saveCartFeeSettings", "buildLineKey", "encodeVariantSelectionMap", "parseVariantSelectionMap", "encodeAddOnSelectionSet", "parseAddOnSelectionSet", "computeOptionsDeltaCents", "validatePromoMock"], "search-terms": ["CartRepository", "LiveData", "PreferencesStorage", "CartLine", "ItemConfiguration", "PromoKind", "applyPromoCode", "CartTotals", "FeeSettings", "calculate totals", "cart persistence", "Android in-memory cart", "local storage"], "state": 2, "file_id": 14, "knowledge_revision": 215, "git_revision": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb", "revision_history": [{"49": ""}, {"78": "bee0400471853af593870aafc261dd9c589a0db7"}, {"118": "50c7aa46afe96fafa36f6da7e89f8349bbf6dc59"}, {"147": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb"}, {"202": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb"}, {"215": "64d44e6090eb0299f2ed220a6ee210cd2ab7fbeb"}], "hash": "68daaf15de105b8778fb0a7ae7f88b0e", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/cart/CartRepository.kt"}