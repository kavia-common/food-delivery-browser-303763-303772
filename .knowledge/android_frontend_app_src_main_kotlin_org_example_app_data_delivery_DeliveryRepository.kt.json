{"is_source_file": true, "format": "Kotlin", "description": "This file defines a singleton repository class 'DeliveryRepository' responsible for managing the state of food delivery orders in a simulated environment. It handles order lifecycle, persistence, scheduling state transitions, and exposing live data for UI updates.", "external_files": ["org.example.app.data.cart.CartRepository", "org.example.app.data.models.CartLine", "org.example.app.data.storage.PreferencesStorage", "org.example.app.data.delivery.DeliveryCodec", "org.example.app.data.delivery.StoredDeliveryOrder", "org.example.app.data.delivery.DeliveryStage", "org.example.app.notifications.NotificationHelper"], "external_methods": ["PreferencesStorage.from", "PreferencesStorage.loadActiveDeliveryOrderEncoded", "PreferencesStorage.saveActiveDeliveryOrderEncoded", "DeliveryCodec.decode", "DeliveryCodec.encode", "NotificationHelper.ensureChannel", "NotificationHelper.postStageChanged"], "published": ["DeliveryRepository"], "classes": [{"name": "DeliveryRepository", "description": "Singleton object managing delivery order states, persisting data, and scheduling transitions."}], "methods": [{"name": "initialize", "description": "Initializes the delivery repository, loads persisted order, recreates schedules, and starts countdown."}, {"name": "placeOrderFromCart", "description": "Creates a new order based on cart contents, persists it, and schedules stage transitions."}, {"name": "cancelActiveOrder", "description": "Cancels the current active order, stops timers, and clears persistence."}, {"name": "summarizeCart", "description": "Generates a summary string of the cart contents."}, {"name": "nextDelayMs", "description": "Random delay within 20-30 seconds used between stage transitions."}, {"name": "persistAndPublish", "description": "Persists the current order and updates live data."}, {"name": "updateRemainingEta", "description": "Updates the estimated time remaining for the next transition."}, {"name": "scheduleNextTransitionIfNeeded", "description": "Schedules the next stage transition if applicable."}, {"name": "advanceStageIfDue", "description": "Advances the order to the next stage if the scheduled time has arrived."}, {"name": "startCountdownTicker", "description": "Starts periodic updates of ETA remaining."}, {"name": "stopScheduledTransition", "description": "Stops the scheduled stage transition."}, {"name": "stopCountdownTicker", "description": "Stops ETA countdown updates."}, {"name": "stopTimers", "description": "Stops all timers related to stage transitions and countdown."}], "calls": ["handler.postDelayed", "handler.post", "handler.removeCallbacks", "System.currentTimeMillis", "max", "Math.max"], "search-terms": ["delivery stage management", "order scheduling", "Simulated delivery", "LiveData updates", "Order lifecycle", "order scheduling", "order persistence", "stage transition timing"], "state": 2, "file_id": 58, "knowledge_revision": 210, "git_revision": "6e91d21a038bee6a12947e6117ed8dfb31963ce7", "hash": "c8ecd4dca2d9ebdcb8ad946afdc849bb", "format-version": 4, "code-base-name": "android_frontend", "filename": "android_frontend/app/src/main/kotlin/org/example/app/data/delivery/DeliveryRepository.kt", "revision_history": [{"210": "6e91d21a038bee6a12947e6117ed8dfb31963ce7"}]}